<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="page_title">Filtros2</title>

    <!-- Carga de estilos -->
    <link rel="stylesheet" href="styles.css">

    <!-- Carga de Chart.js (necesario para el gr√°fico) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Librer√≠a para generar PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Librer√≠a para c√≥digos QR -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>

    <!-- Tu script principal -->
    <script defer src="script.js"></script>

</head>

<body>
    <div class="container">
        <h1 data-i18n="marcas_titulo">Marcas de Filtros</h1>

        <!-- Buscador -->
        <div class="filters-controls" style="text-align:center; margin-bottom:12px;">
            <input id="brand-search" type="search" data-i18n-placeholder="search_placeholder" placeholder="Buscar marca o modelo..."
                style="width:70%; padding:8px;" />
        </div>

        <!-- Lista de filtros -->
        <ul id="brands-root">
            <!-- Aqu√≠ se inyectan din√°micamente las marcas y modelos -->
        </ul>

        <!-- Bloque del gr√°fico circular -->
        <div class="stats-card" style="margin-top:18px; text-align:left;">
            <h3 data-i18n="chart_title">Filtros por referencia</h3>

            <!-- Selector para filtrar -->
            <div style="margin-bottom:15px; text-align:center; padding:10px; background:rgba(255,255,255,0.1); border-radius:10px;">
                <label for="filtros-ref-select" data-i18n="filter_label" style="color:#fff; font-size:1.1em; font-weight:bold; text-shadow:0 2px 4px rgba(0,0,0,0.5); margin-right:10px;">Filtrar por tipo:</label>
                <select id="filtros-ref-select" onchange="updateFilterReferencesChart()">
                    <option value="todos" data-i18n="filter_all">Todos</option>
                    <option value="aceite" data-i18n="filter_oil">Aceite</option>
                    <option value="aire" data-i18n="filter_air">Aire</option>
                    <option value="habitaculo" data-i18n="filter_cabin">Habit√°culo</option>
                    <option value="combustible" data-i18n="filter_fuel">Combustible</option>
                    <option value="pastillas_freno" data-i18n="filter_brake_pads">Pastillas de freno</option>
                </select>
                <span id="total-filtros-ref" style="margin-left:16px; font-weight:bold;" data-i18n-prefix="total_label">Total: 0</span>
            </div>

            <!-- Gr√°fico y leyenda -->
            <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:center;">
                <div style="position:relative;">
                    <canvas id="filtros-ref-chart" width="260" height="260" data-i18n-title="chart_click_tooltip" title="Haz clic para ver en grande"></canvas>
                    <div id="chart-expand-hint" style="position:absolute; bottom:5px; right:5px; background:rgba(0,0,0,0.7); color:white; padding:4px 8px; border-radius:4px; font-size:0.8em; pointer-events:none;" data-i18n="chart_expand_hint">
                        üîç Clic para ampliar
                    </div>
                </div>
                <div id="filtros-ref-legend" style="max-width:320px; text-align:left;"></div>
            </div>
        </div>

        <!-- Bloque del gr√°fico lineal de precios -->
        <div class="stats-card" style="margin-top:18px; text-align:left;">
            <h3 data-i18n="price_chart_title">Precios Promedio por Tipo</h3>
            
            <!-- Controles del gr√°fico lineal -->
            <div style="margin-bottom:12px; text-align:center;">
                <button onclick="togglePriceChartType()" id="chart-type-btn" style="background: linear-gradient(145deg, #9b59b6, #8e44ad); padding: 8px 16px; margin-right: 10px;" data-i18n="btn_toggle_chart">üìä Cambiar a Barras</button>
                <span id="price-chart-info" style="margin-left:16px; font-weight:bold; color:#fff;" data-i18n-prefix="price_info">Precios en ‚Ç¨</span>
            </div>

            <!-- Contenedor del gr√°fico lineal -->
            <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:center;">
                <div style="position:relative;">
                    <canvas id="price-chart" width="500" height="300" title="Gr√°fico de precios por tipo"></canvas>
                    <div style="position:absolute; bottom:5px; right:5px; background:rgba(0,0,0,0.7); color:white; padding:4px 8px; border-radius:4px; font-size:0.8em; pointer-events:none;" data-i18n="price_chart_hint">
                        üìà Precios promedio
                    </div>
                </div>
                <div id="price-legend" style="max-width:320px; text-align:left; color:#fff;">
                    <!-- Leyenda del gr√°fico de precios -->
                </div>
            </div>
        </div>

        <!-- Botones de acci√≥n -->
        <div style="text-align:center; margin-top:16px;">
            <button onclick="generateFiltersPDF()" style="background: linear-gradient(145deg, #27ae60, #229954); margin-right: 10px;" data-i18n="btn_download_pdf">üìÑ Descargar PDF</button>
            <button onclick="openQRModal()" style="background: linear-gradient(145deg, #9b59b6, #8e44ad); margin-right: 10px;" data-i18n="btn_generate_qr">üì± C√≥digos QR</button>
            <button onclick="openCostModal()" style="background: linear-gradient(145deg, #f39c12, #e67e22); margin-right: 10px;" data-i18n="btn_cost_management">üí∞ Gesti√≥n Costos</button>
            <a href="index.html"><button data-i18n="btn_volver">Volver</button></a>
        </div>
    </div>

    <!-- Modal para gr√°fico grande -->
    <div id="chart-modal" class="chart-modal">
        <div class="chart-modal-content">
            <button class="chart-modal-close" onclick="closeChartModal()">&times;</button>
            <h3 class="chart-modal-title" id="chart-modal-title" data-i18n="modal_chart_title">Gr√°fico de Filtros</h3>
            <canvas id="chart-modal-canvas" width="500" height="500"></canvas>
            <div class="chart-modal-legend" id="chart-modal-legend"></div>
        </div>
    </div>

    <!-- Modal para c√≥digos QR -->
    <div id="qr-modal" class="chart-modal">
        <div class="chart-modal-content">
            <button class="chart-modal-close" onclick="closeQRModal()">&times;</button>
            <h3 class="chart-modal-title" data-i18n="qr_modal_title">C√≥digos QR de Filtros</h3>
            <div id="qr-content" style="max-height: 400px; overflow-y: auto;">
                <!-- Aqu√≠ se generar√°n los c√≥digos QR -->
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="downloadAllQRs()" style="background: linear-gradient(145deg, #27ae60, #229954);" data-i18n="btn_download_all_qr">üì± Descargar Todos los QR</button>
            </div>
        </div>
    </div>

    <!-- Modal para gesti√≥n de costos -->
    <div id="cost-modal" class="chart-modal">
        <div class="chart-modal-content">
            <button class="chart-modal-close" onclick="closeCostModal()">&times;</button>
            <h3 class="chart-modal-title" data-i18n="cost_modal_title">Gesti√≥n de Costos</h3>
            <div id="cost-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h4 data-i18n="cost_summary_title">Resumen de Costos</h4>
                        <div id="cost-summary" style="background: rgba(0,0,0,0.1); padding: 15px; border-radius: 8px;">
                            <!-- Resumen de costos -->
                        </div>
                    </div>
                    <div>
                        <h4 data-i18n="stock_alerts_title">Alertas de Stock</h4>
                        <div id="stock-alerts" style="background: rgba(0,0,0,0.1); padding: 15px; border-radius: 8px;">
                            <!-- Alertas de stock bajo -->
                        </div>
                    </div>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 data-i18n="cost_table_title">Tabla de Precios</h4>
                        <div>
                            <button onclick="exportPricesToCSV()" style="background: linear-gradient(145deg, #27ae60, #229954); padding: 8px 16px; margin-right: 8px;" data-i18n="btn_export_csv">üìä Exportar CSV</button>
                            <button onclick="openPriceEditor()" style="background: linear-gradient(145deg, #3498db, #2980b9); padding: 8px 16px;" data-i18n="btn_edit_prices">‚úèÔ∏è Editar Precios</button>
                        </div>
                    </div>
                    <div id="cost-table" style="max-height: 300px; overflow-y: auto;">
                        <!-- Tabla de precios -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar precios -->
    <div id="price-editor-modal" class="chart-modal">
        <div class="chart-modal-content" style="max-width: 800px;">
            <button class="chart-modal-close" onclick="closePriceEditor()">&times;</button>
            <h3 class="chart-modal-title" data-i18n="price_editor_title">Editor de Precios</h3>
            <div style="margin-bottom: 15px; text-align: center;">
                <button onclick="saveAllPrices()" style="background: linear-gradient(145deg, #27ae60, #229954); margin-right: 10px;" data-i18n="btn_save_prices">üíæ Guardar Todos</button>
                <button onclick="resetPrices()" style="background: linear-gradient(145deg, #e74c3c, #c0392b);" data-i18n="btn_reset_prices">üîÑ Restaurar</button>
            </div>
            <div id="price-editor-content" style="max-height: 500px; overflow-y: auto;">
                <!-- Aqu√≠ se generar√° el formulario de precios -->
            </div>
        </div>
    </div>
</body>

</html>